export const meta = {
  title: `Create your application`,
  description: `Project setup for Amplify prior to adding category specific example.`
};

import ios0 from '/src/fragments/lib/project-setup/native_common/create-application/common.mdx';

<Fragments fragments={{ ios: ios0 }} />

import android1 from '/src/fragments/lib/project-setup/native_common/create-application/common.mdx';

<Fragments fragments={{ android: android1 }} />

import flutter2 from '/src/fragments/lib/project-setup/native_common/create-application/common.mdx';

<Fragments fragments={{ flutter: flutter2 }} />

<InlineFilter filters={['react-native']}>
To get started, initialize a new React Native project.

<BlockSwitcher>
<Block name="Expo CLI">

Create a new app with the following command:    

```bash
npx create-expo-app amplified_todo

cd amplified_todo
```

Install the necessary dependencies by running the following command:

```sh
npm install aws-amplify amazon-cognito-identity-js @react-native-community/netinfo @react-native-async-storage/async-storage
```

Start the app with the following command:

```bash
npm start
```

```console
› Scan the QR code above with Expo Go (Android) or the Camera app (iOS)

› Press a │ open Android
› Press w │ open web

› Press j │ open debugger
› Press r │ reload app
› Press m │ toggle menu

› Press ? │ show all commands

Logs for your project will appear below. Press Ctrl+C to exit.
```

</Block>
<Block name="React Native CLI">

After you [setup development environment](https://reactnative.dev/docs/environment-setup), create a new app with the following command:    

```bash
npx react-native init amplified_todo

cd amplified_todo
```

Install the necessary dependencies by running the following command:

```sh
npm install aws-amplify amazon-cognito-identity-js @react-native-community/netinfo @react-native-async-storage/async-storage
```

You will also need to install the pod dependencies for iOS:

```sh
npx pod-install
```

Start the app with the following command:

```bash
npm start
```

```console
r - reload the app
d - open developer menu
i - run on iOS
a - run on Android
```

</Block>
</BlockSwitcher>

## Initialize a new backend

With the app running, it's time to set up Amplify and create the backend services to support the app.

Open a new terminal. From the **amplified_todo** directory, run:

```bash
amplify init
```

When you initialize Amplify you'll be prompted for some information about the app, with the option to accept recommended values:

```console
? Enter a name for the project (amplified_todo) 
The following configuration will be applied:

Project information
| Name: amplified_todo
| Environment: dev
| Default editor: Visual Studio Code
| App type: javascript
| Javascript framework: react-native
| Source Directory Path: /
| Distribution Directory Path: /
| Build Command: npm run-script build
| Start Command: npm run-script start

? Initialize the project with the above configuration? Yes
Using default provider  awscloudformation
? Select the authentication method you want to use: AWS profile
? Please choose the profile you want to use default
```

> Amplify CLI will infer the proper configuration based on the type of project Amplify is being initialized in where possible. Adjust if needed.

When you initialize a new Amplify project, a few things happen:

- It creates a top level directory called **amplify** that stores your backend definition. During the tutorial you'll add capabilities such as a GraphQL API and authentication. As you add features, the **amplify** folder will grow with infrastructure-as-code templates that define your backend stack. Infrastructure-as-code is a best practice way to create a replicable backend stack.
- It creates a file called **aws-exports.js** in the **root** directory that holds all the configuration for the services you create with Amplify. This is how the Amplify client is able to get the necessary information about your backend services.
- It modifies the **.gitignore** file, adding some generated files to the ignore list
- A cloud project is created for you in the AWS Amplify Console that can be accessed by running `amplify console`. The Console provides a list of backend environments, deep links to provisioned resources per Amplify category, status of recent deployments, and instructions on how to promote, clone, pull, and delete backend resources

## Set up frontend

Next, configure Amplify so it can interact with backend services.

Open **index.js** (React Native CLI) or **App.js** (Expo CLI) and add the following code below the last import:

```javascript
import { Amplify } from 'aws-amplify';
import awsExports from './src/aws-exports';
Amplify.configure(awsExports);
```
</InlineFilter>

<InlineFilter filters={['js']}>

<BlockSwitcher>

<Block name="NextJS">

To set up the project, you'll first create a new Next.js app with [Create Next App](https://nextjs.org/docs/api-reference/create-next-app), a simple CLI tool that enables you to quickly start building a new Next.js application, with everything set up for you. You'll then add Amplify and initialize a new project.

From your projects directory, run the following commands:

```bash
npx create-next-app@latest next-amplified --no-app
cd next-amplified
```

You'll need to select if you'd like to build this project with TypeScript (Yes) or JavaScript (No), and then if you'd like ESLint to be configured as well.

Once these have been selected, a new Next.js app will be created in a directory called `next-amplified` and then switches us into that new directory.

Now that you're in the root of the project, you can run the app by using the following command:

```bash
npm run dev
```

This runs a development server and allows us to see the output generated by the build, you can see the running app by navigating to <http://localhost:3000>.

</Block>

<Block name="ReactJS">

TODO: Show how to install react with Vite rather than using create-react-app.

To get started, first create a new React app, and then install and use the Amplify CLI to start adding backend capabilities to your app.

From your projects directory, run the following commands:

```bash
npx create-react-app react-amplified
cd react-amplified
```

This creates a new React app in a directory called **react-amplified** and then switches into the new directory. 

From the **react-amplified** directory, run the app by using the following command:

```bash
npm start
```

This runs a development server and allows you to see the output generated by the build. You can see the running app by navigating to [http://localhost:3000](http://localhost:3000).

</Block>

<Block name="Angular">

Use the [Angular CLI](https://github.com/angular/angular-cli) to bootstrap a new Angular app:

```bash
npx -p @angular/cli ng new amplify-app

? Would you like to add Angular routing? Y
? Which stylesheet format would you like to use? (your preferred stylesheet provider)

cd amplify-app
```

Angular 6+ does not include shims for 'global' or 'process'.

<BlockSwitcher>

<Block name="Angular 15">

First, create `src/polyfills.ts` and add the following:

```javascript
(window as any).global = window;
(window as any).process = {
  env: { DEBUG: undefined },
};
```

Then, open your `angular.json` file, and add `src/polyfills.ts` to polyfills array(s) in your `angular.json`. These arrays are located in projects.`<project-name>.architect.<task-name>.options`.

```javascript
"polyfills": [
  "zone.js",
  "src/polyfills.ts"
],
```

And finally, make sure to add `src/polyfills` to files in your `tsconfig.app.json`:

```javascript
{
  "files": [
    "src/main.ts",
    "src/polyfills.ts"
  ],
}
```
</Block>

<Block name="Angular 6-14">

Add the following to your `src/polyfills.ts` file to recreate them: 

```javascript
(window as any).global = window;
(window as any).process = {
  env: { DEBUG: undefined },
};
```

</Block>

</BlockSwitcher>

</Block>

<Block name="VueJS">

Use the Vue Vite powered `create-app` to bootstrap a new Vue 3 app (selecting the defaults will work for this project):



```bash
npm init vue@3

Need to install the following packages:
  create-vue@3
Ok to proceed? (y) y

✔ Project name: … myamplifyproject
✔ Add TypeScript? … No 
✔ Add JSX Support? … No 
✔ Add Vue Router for Single Page Application development? … No 
✔ Add Pinia for state management? … No 
✔ Add Vitest for Unit Testing? … No 
✔ Add Cypress for both Unit and End-to-End testing? … No 
✔ Add ESLint for code quality? … No 

cd myamplifyproject

```

Install required modules:

```bash
npm install
```

Run your app:

```bash
npm run dev
```
Press `Ctrl + C` to stop the server


</Block>

<Block name="Javascript">

Create a new ‘plain’ JavaScript [ES2015](https://babeljs.io/docs/en/learn/) app with webpack. With the following commands, create the directory (`amplify-js-app`) and files for the app.

```bash
mkdir -p amplify-js-app/src && cd amplify-js-app
touch index.html src/app.js webpack.config.js
```

Initialize npm and install dependencies and dev dependencies.

```bash
npm init
npm install aws-amplify
npm install webpack webpack-cli webpack-dev-server copy-webpack-plugin --save-dev
```

The app directory structure should be:

```console
amplify-js-app
├── node_modules/
├── src/
│   └── app.js
├── index.html
├── package-lock.json
├── package.json
└── webpack.config.js
```

Add the following scripts to the `package.json` file:

```json
"scripts": {
    "start": "webpack && webpack-dev-server --mode development",
    "build": "webpack"
}
```

Add the following to the `index.html` file:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Amplify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html,
      body {
        font-family: 'Amazon Ember', 'Helvetica', 'sans-serif';
        margin: 0;
      }
      a {
        color: #ff9900;
      }
      h1 {
        font-weight: 300;
      }
      hr {
        height: 1px;
        background: lightgray;
        border: none;
      }
      .app {
        width: 100%;
      }
      .app-header {
        color: white;
        text-align: center;
        background: linear-gradient(30deg, #f90 55%, #ffc300);
        width: 100%;
        margin: 0 0 1em 0;
        padding: 3em 0 3em 0;
        box-shadow: 1px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .app-body {
        width: 400px;
        margin: 0 auto;
        text-align: center;
      }
      .app-body button {
        background-color: #ff9900;
        font-size: 14px;
        color: white;
        text-transform: uppercase;
        padding: 1em;
        border: none;
      }
      .app-body button:hover {
        opacity: 0.8;
      }
    </style>
  </head>

  <body>
    <div class="app">
      <div class="app-header">
        <h1>Welcome to Amplify</h1>
      </div>
      <div class="app-body">
        <h1>Mutation Results</h1>
        <button id="MutationEventButton">Add data</button>
        <div id="MutationResult"></div>
        <hr />

        <h1>Query Results</h1>
        <div id="QueryResult"></div>
        <hr />

        <h1>Subscription Results</h1>
        <div id="SubscriptionResult"></div>
      </div>
    </div>
    <script src="main.bundle.js"></script>
  </body>
</html>
```

Add the following to the `webpack.config.js` file:

```js
const CopyWebpackPlugin = require('copy-webpack-plugin');
const webpack = require('webpack');
const path = require('path');

module.exports = {
  mode: 'development',
  entry: './src/app.js',
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/
      }
    ]
  },
  devServer: {
    client: {
      overlay: true
    },
    hot: true,
    watchFiles: ['src/*', 'index.html']
  },
  plugins: [
    new CopyWebpackPlugin({
      patterns: ['index.html']
    }),
    new webpack.HotModuleReplacementPlugin()
  ]
};
```

Run the app:

```bash
npm start
```

Open a browser and navigate to <http://localhost:8080>.

</Block>


</BlockSwitcher>

## Create a new Amplify backend

Now that you have a running Angular app, it's time to set up Amplify for this app so that you can create the necessary backend services needed to support the app. 

Open a new terminal. From the root of the project, run:

```bash
amplify init
```

When you initialize Amplify you'll be prompted for some information about the app.  For newer versions of Angular, you will have to change the Distribution Directory Path from `dist` to `dist/amplify-app` to match how Angular will build your project.

```console
? Enter a name for the project: amplifyapp
The following configuration will be applied:

Project information
| Name: amplifyapp
| Environment: dev
| Default editor: Visual Studio Code
| App type: javascript
| Javascript framework: <Framework Name>
| Source Directory Path: src
| Distribution Directory Path: dist
| Build Command: npm run-script build
| Start Command: ng serve

? Initialize the project with the above configuration? Yes
Using default provider  awscloudformation
? Select the authentication method you want to use: AWS profile

For more information on AWS Profiles, see:
https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html

? Please choose the profile you want to use: default
```

When you initialize a new Amplify project, a few things happen:

- It creates a top level directory called `amplify` that stores your backend definition. During the tutorial you'll add capabilities such as authentication, GraphQL API, storage, and set up authorization rules for the API. As you add features, the `amplify` folder will grow with infrastructure-as-code templates that define your backend stack. Infrastructure-as-code is a best practice way to create a replicable backend stack.
- It creates a file called `aws-exports.js` in the `src` directory that holds all the configuration for the services you create with Amplify. This is how the Amplify client is able to get the necessary information about your backend services.
- It modifies the `.gitignore` file, adding some generated files to the ignore list.
- A cloud project is created for you in the AWS Amplify Console that can be accessed by running `amplify console`. The Console provides a list of backend environments, deep links to provisioned resources per Amplify category, status of recent deployments, and instructions on how to promote, clone, pull, and delete backend resources.

## Install Amplify libraries

Inside the your app directory, install the Amplify JavaScript library and run your app:

```bash
npm install aws-amplify
```

If you have TypeScript [strict mode](https://www.typescriptlang.org/tsconfig/#strict) on and see the error

```
Could not find a declaration file for module './aws-exports'. 'aws-exports.js' implicitly has an 'any' type.
```

Create a `aws-exports.d.ts` file on the same level as aws-exports with the following content:

```ts
declare const awsmobile: Record<string, any>
export default awsmobile;
```

Your app is now setup, and you are ready to start building your features with AWS Amplify.

- [Authentication](/lib/auth/getting-started)
- [User File Storage](/lib/storage/getting-started)
- [Analytics](/lib/analytics/getting-started)

</InlineFilter>
