export const meta = {
  title: `Password & user management`,
  description: `Learn more about how to handle common password and user management scenarios. E.g. password reset, account recovery etc.`
};

This section covers the client-side development experience for password and user management. To learn more about exposing administration actions to your application, click [here](/cli/auth/admin).

## Password operations

### Reset Password

In order to reset your password, use the resetPassword api - this will send a code to the user attribute configured to receive such a reset code (e.g. email or SMS):

import jsResetPassword from "/src/fragments/lib-v1/auth/js/password_management/reset_password.mdx"

<Fragments fragments={{js: jsResetPassword}}/>

To complete the password reset process, invoke the `confirmResetPassword` API with the code you were sent and the new password you want to update.

import jsCompleteResetPassword from "/src/fragments/lib-v1/auth/js/password_management/confirm_reset_password.mdx"

<Fragments fragments={{js: jsCompleteResetPassword}}/>

### Update password

A signed in user can update their password using the `updatePassword` API.

import jsUpdatePassword from "/src/fragments/lib-v1/auth/js/password_management/update_password.mdx"

<Fragments fragments={{js: jsUpdatePassword}}/>

## Retrieve current authenticated user

You can call `getCurrentUser` to get the current authenticated user object.

import jsGetCurrentUser from "/src/fragments/lib-v1/auth/js/user_attributes/get_current_user.mdx"

<Fragments fragments={{js: jsGetCurrentUser}}/>

This method can be used to check if a user is logged in when the page is loaded. It will throw an `AuthError` if there is no user logged in. This method should be called after the Auth module is configured and the user is logged in.

## Retrieve current session

`fetchAuthSession` returns the current user's session with `tokens` and AWS `credentials`.

If tokens are expired, this method will automatically refresh the tokens. You can also use this method to force refresh the session by passing a `forceRefresh` flag in the request of the API.

import jsFetchAuthSession from "/src/fragments/lib-v1/auth/js/user_session/fetch_auth_session.mdx"

<Fragments fragments={{js: jsFetchAuthSession}}/>

## Managing user attributes

Attributes such as `name`, `email`, `phone_number` help you identify individual users. The Amplify JavaScript library contains 
a set of APIs that can help you manage attributes while the user is authenticated.

### Pass user attributes during sign up

Amazon Cognito has a set of default standard attributes. You can find a list of all the standard attributes [here](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html#cognito-user-pools-standard-attributes)

In addition, Cognito allows to set up to 50 custom attributes in the user pool. Documentation on custom attributes can be found [here](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html#user-pool-settings-custom-attributes).

You can pass them in the `userAttributes` key of the `signUp` API:

```javascript
signUp({
	username: 'jdoe',
	password: 'mysecurerandompassword#123',
	options: {
		userAttributes: {
			email: 'me@domain.com',
			phone_number: '+12128601234',
			given_name: 'Jane',
			family_name: 'Doe',
			nickname: 'Jane',
			'custom:attribute_name': 'attribute_value',
		},
	},
});
```

### Retrieve user attributes

The user can get the last updated user attributes.

import jsFetchUserAttributes from "/src/fragments/lib-v1/auth/js/user_attributes/fetch_user_attributes.mdx"

<Fragments fragments={{js: jsFetchUserAttributes}}/>

### Update user attributes

Invoke the `updateUserAttributes` API to create or update existing user attributes.

```ts
import { Auth } from 'aws-amplify';

async function updateUserAttributes () {
  try {
    const user = await Auth.currentAuthenticatedUser();
    const result = await Auth.updateUserAttributes(user, {
      email: 'me@anotherdomain.com',
      family_name: 'Lastname'
    });
    console.log(result); // SUCCESS
  } catch(err) {
    console.log(err);
  }
};
```

<Callout>
Note: If you change an attribute that requires confirmation (i.e. email or phone number), you will receive a confirmation code to that attribute.
</Callout> 

### Confirm attribute

If you change the email address, you will receive a confirmation code to the new email address. Below is an example of how to confirm the new 
email address in your app:

```javascript
const result = await Auth.verifyCurrentUserAttributeSubmit('email', '<verification_code>');
```

## Updating and verifying a user email address

Updating an email address using `Auth.updateUserAttributes` will require a verification of the new email address. The user will be emailed a verification code to the updated email address and your application will need to receive the verification code and send it to `Auth.verifyCurrentUserAttributeSubmit` before the email address will be updated in Cognito.

The React application below implements this flow of updating the email address for the current user when the "Update Email" button is clicked, then provides a form to capture the verification code sent to the user.

<BlockSwitcher>
<Block name="TypeScript">

```ts
// App.js
import { Authenticator } from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css'; 
import { Auth } from 'aws-amplify';
import { useState } from 'react';

async function updateUserEmail() {
  try {
    const user = await Auth.currentAuthenticatedUser();
    await Auth.updateUserAttributes(user, {
      email: 'updatedEmail@mydomain.com'
    });

    console.log('a verification code is sent');
  } catch(err) {
    console.log('failed with error', err);
  }
}

async function verifyEmailValidationCode(code: string) {
  try {
    await Auth.verifyCurrentUserAttributeSubmit('email', code);
    console.log('email verified');
  } catch(err) {
    console.log('failed with error', err);
  }
}

function ValidationCodeForm() {
  const [validationCode, setValidationCode] = useState<string | null>(null);
  return (
    <div>
      <label>
        Verification Code (sent to the new email):
        <input
          onChange={(e) => {
            setValidationCode(e.target.value);
          }}
          type="text"
          name="vc"
        />
      </label>
      <button onClick={() => validationCode && verifyEmailValidationCode(validationCode)}>
        Send Code
      </button>
    </div>
  );
}

export default function App() {
  const [showValidationCodeUI, setShowValidationCodeUI] = useState(false);

  return (
    <Authenticator>
      {({ signOut, user }) => (
        <div className="App">
          <div>
            <pre>{JSON.stringify(user?.attributes, null, 2)}</pre>
          </div>
          {showValidationCodeUI === false && (
            <button
              onClick={async () => { 
                await updateUserEmail();
                setShowValidationCodeUI(true);
              }}
            >
              Update Email
            </button>
          )}
          {showValidationCodeUI === true && <ValidationCodeForm />}
          <button onClick={signOut}>Sign out</button>
        </div>
      )}
    </Authenticator>
  );
}
```
</Block>
<Block name="JavaScript">

```javascript
// App.js
import { Authenticator } from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';
import { Auth } from 'aws-amplify';
import { useState } from 'react';

async function updateUserEmail() {
  try {
    const user = await Auth.currentAuthenticatedUser();
    await Auth.updateUserAttributes(user, {
      email: 'updatedEmail@mydomain.com'
    });

    console.log('a verification code is sent');
  } catch(err) {
    console.log('failed with error', err);
  }
}

async function verifyEmailValidationCode(code) {
  try {
    await Auth.verifyCurrentUserAttributeSubmit('email', code);
    console.log('email verified');
  } catch(err) {
    console.log('failed with error', err);
  }
}

function ValidationCodeForm() {
  const [validationCode, setValidationCode] = useState(null);
  return (
    <div>
      <label>
        Verification Code (sent to the new email):
        <input
          onChange={(e) => {
            setValidationCode(e.target.value);
          }}
          type="text"
          name="vc"
        />
      </label>
      <button onClick={() => verifyEmailValidationCode(validationCode)}>
        Send Code
      </button>
    </div>
  );
}

export default function App() {
  const [showValidationCodeUI, setShowValidationCodeUI] = useState(false);

  return (
    <Authenticator>
      {({ signOut, user }) => (
        <div className="App">
          <div>
            <pre>{JSON.stringify(user.attributes, null, 2)}</pre>
          </div>
          {showValidationCodeUI === false && (
            <button
              onClick={async () => {
                await updateUserEmail();
                setShowValidationCodeUI(true);
              }}
            >
              Update Email
            </button>
          )}
          {showValidationCodeUI === true && <ValidationCodeForm />}
          <button onClick={signOut}>Sign out</button>
        </div>
      )}
    </Authenticator>
  );
}
```
</Block>
</BlockSwitcher>
