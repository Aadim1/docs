import { getCustomStaticPath } from '@/utils/getCustomStaticPath';

export const meta = {
  title: 'Connect your app code to the API',
  description: 'Learn how to connect your app code to the API.',
  platforms: ['javascript', 'react-native']
};

export const getStaticPaths = async () => {
  return getCustomStaticPath(meta.platforms);
};

export function getStaticProps(context) {
  return {
    props: {
      platform: context.params.platform,
      meta
    }
  };
}

<InlineFilter filters={["js", "react-native"]}>

In this guide, you will connect your application code to the backend API using the Amplify Libraries. We will review how to install and configure Amplify Libraries.

Before you begin, you will need:
- An GraphQL API already set up either via the [Amplify CLI](/lib/graphqlapi/getting-started/), or directly via the underlying [AWS AppSync service](https://docs.aws.amazon.com/appsync/latest/devguide/designing-a-graphql-api.html).
- A frontend application set up. For instructions on setting up an app, see [Project Setup: Create your application](https://docs.amplify.aws/lib/project-setup/create-application/q/platform/js/)
- [npm installed](https://docs.npmjs.com/getting-started)

## Install the Amplify Library

The Amplify Library is the recommended client library used to connect to your GraphQL APIs. To install the the Amplify client library, navigate to your frontend's root folder and run the following command in your Terminal:

```bash
npm install aws-amplify
```

## Configure the Amplify Library

You will then configure the library to connect with the Amplify CLI-provisioned API or you existing AppSync GraphQL API:

<BlockSwitcher>

<Block name="Amplify CLI-provisioned API">

When you deploy your backend (`amplify push`), an `aws-exports.js` file is generated for you. This file contains your API's endpoint information and auth configurations.

```ts
import { Amplify } from 'aws-amplify'
// highlight-next-line
import awsconfig from './aws-exports'

// highlight-next-line
Amplify.configure(awsconfig)
```

</Block>
<Block name="Existing AppSync GraphQL API">

To connect your app code to your GraphQL API, you need to provide two configurations:

1. the API endpoint URL
2. the default authorization mode

#### Configure the GraphQL API endpoint URL

The Amplify Library connects you to a GraphQL API endpoint based on the information provided to `Amplify.configure()`.

When working with existing GraphQL APIs, you must manually provide your API endpoint and auth configurations. First, to configure the GraphQL API endpoint URL, set the `aws_appsync_graphqlEndpoint` and `aws_appsync_region` values. 

```ts
```

</Block>

</BlockSwitcher>

## Use generated GraphQL queries, mutations, and subscriptions

You can use the generated GraphQL code after you import them into your codebase and pass them into the `API.graphql()` operation. With GraphQL, you typically have the following types of operations to interact with the API from a JavaScript client:

- __Mutations__ - write data to the API (create, update, and delete operations)

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from 'aws-amplify';
import { createTodo, updateTodo, deleteTodo } from './graphql/mutations';
import { GraphQLQuery } from '@aws-amplify/api';
import { CreateTodoInput, CreateTodoMutation, UpdateTodoMutation, DeleteTodoMutation } from './API';

const todo: CreateTodoInput = { name: "My first todo", description: "Hello world!" };

/* create a todo */
await API.graphql<GraphQLQuery<CreateTodoMutation>>({
  query: createTodo,
  variables: {
    input: todo
  }
});

/* update a todo */
await API.graphql<GraphQLQuery<UpdateTodoMutation>>({
  query: updateTodo,
  variables: {
    input: {
      id: "ENTER_TODO_ID_HERE",
      name: "Updated todo info"
    }
  }
});

/* delete a todo */
await API.graphql<GraphQLQuery<DeleteTodoMutation>>({
  query: deleteTodo,
  variables: {
    input: {
      id: "ENTER_TODO_ID_HERE"
    }
  }
});
```

</Block>
<Block name="JavaScript">

```js
import { API } from 'aws-amplify';
import { createTodo, updateTodo, deleteTodo } from './graphql/mutations';

const todo = { name: "My first todo", description: "Hello world!" };

/* create a todo */
await API.graphql({
  query: createTodo,
  variables: {
    input: todo
  }
});

/* update a todo */
await API.graphql({
  query: updateTodo,
  variables: {
    input: {
      id: "ENTER_TODO_ID_HERE",
      name: "Updated todo info"
    }
  }
});

/* delete a todo */
await API.graphql({
  query: deleteTodo,
  variables: {
    input: {
      id: "ENTER_TODO_ID_HERE"
    }
  }
});
```

</Block>
</BlockSwitcher>

- __Queries__ - read data from the API (list and get operations)

<BlockSwitcher>
<Block name="TypeScript">

```ts
import { API } from 'aws-amplify';
import { GraphQLQuery } from '@aws-amplify/api';
import { listTodos } from './graphql/queries';
import { ListTodosQuery } from './API';

const todos = await API.graphql<GraphQLQuery<ListTodosQuery>>({ query: listTodos });
```

</Block>


<Block name="JavaScript">

```js
import { API } from 'aws-amplify';
import { listTodos } from './graphql/queries';

const todos = await API.graphql({ query: listTodos });
```

</Block>
</BlockSwitcher>

To learn more about queries, mutations, and subscriptions in more detail, see the guides to [*Create, update, and delete application data*](/lib/graphqlapi/mutate-data/q/platform/js/) and [*Read application data*](/lib/graphqlapi/query-data/q/platform/js/).

## Conclusion

Congratulations! You have finished the **Connect your app code to the API** guide. In this guide, you reviewed the required configuration and installed and configured Amplify Libraries. You also reviewed some quick ways to write and read this data.

## Next steps

Our recommended next steps include using the API to mutate and query data. You can also review how to subscribe to real-time events to look for mutations in your data. Some resources that will help with this work include:
- [Create, update, and delete application data](/lib/graphqlapi/mutate-data/q/platform/js/)
- [Read application data](/lib/graphqlapi/query-data/q/platform/js/)
- [Subscribe to real-time events](/lib/graphqlapi/subscribe-data/q/platform/js/)

</InlineFilter>
